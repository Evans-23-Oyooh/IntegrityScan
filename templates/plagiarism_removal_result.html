{% extends 'base.html' %}

{% block title %}Plagiarism Removal Results - TextAnalyzer Pro{% endblock %}

{% block content %}
<style>
    .result-header { margin-bottom: 30px; }
    .result-header h1 { color: #1a1a1a; font-weight: 700; font-size: 32px; margin-bottom: 10px; }
    .score-card { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .score-display { text-align: center; }
    .score-number { font-size: 64px; font-weight: 900; margin: 20px 0; color: #10b981; }
    .score-label { font-size: 16px; color: #666; font-weight: 600; }
    .score-status { font-size: 18px; font-weight: 700; margin-top: 15px; padding: 12px; border-radius: 8px; background: #e6f4ea; color: #137333; }
    .progress-bar-custom { height: 30px; background: #e5e5e5; border-radius: 8px; overflow: hidden; margin: 15px 0; }
    .progress-fill { height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
    .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
    .detail-item { background: #f8f9fa; padding: 15px; border-radius: 8px; }
    .detail-label { font-size: 12px; color: #999; text-transform: uppercase; font-weight: 600; margin-bottom: 8px; }
    .detail-value { font-size: 24px; font-weight: 700; color: #1a1a1a; }
    .comparison-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    .text-box { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .text-box h5 { color: #1a1a1a; font-weight: 700; margin-bottom: 15px; }
    .text-preview { background: #f8f9fa; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; font-size: 13px; color: #666; line-height: 1.6; }
    .text-box.original .text-preview { border-left: 4px solid #ef4444; }
    .text-box.processed .text-preview { border-left: 4px solid #10b981; }
    .btn-new-check { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-block; transition: all 0.3s; }
    .btn-new-check:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16,185,129,0.3); color: white; }
    .btn-copy { background: white; color: #10b981; padding: 8px 16px; border-radius: 6px; border: 2px solid #10b981; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-top: 12px; }
    .btn-copy:hover { background: #10b981; color: white; }
    .methods-badge { display: inline-block; background: #10b981; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-right: 8px; margin-bottom: 8px; }
    .quality-indicator { text-align: center; padding: 20px; }
    .quality-icon { font-size: 48px; margin-bottom: 15px; display: block; }
    @media (max-width: 768px) {
        .score-number { font-size: 48px; }
        .comparison-section { grid-template-columns: 1fr; }
        .details-grid { grid-template-columns: 1fr; }
    }
</style>

<div class="result-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>üîß Plagiarism Removal Results</h1>
            <p style="color: #666; margin: 0;">Successfully processed and reduced plagiarism</p>
        </div>
        <a href="{% url 'plagiarism_removal' %}" class="btn-new-check">+ Process Another</a>
    </div>
</div>

<!-- Improvement Card -->
<div class="score-card">
    <div class="score-display">
        <div class="score-label">Plagiarism Reduction</div>
        <div class="score-number">-{{ improvement|floatformat:1 }}%</div>
        <div class="progress-bar-custom">
            <div class="progress-fill" style="width: {{ improvement|floatformat:0 }}%; max-width: 100%;">
                {{ improvement|floatformat:1 }}% Improved
            </div>
        </div>
        <div class="score-status">
            ‚úì Plagiarism Successfully Reduced
        </div>
    </div>

    <div class="details-grid">
        <div class="detail-item">
            <div class="detail-label">Original Plagiarism</div>
            <div class="detail-value" style="color: #ef4444;">{{ original_plagiarism|floatformat:1 }}%</div>
        </div>
        <div class="detail-item">
            <div class="detail-label">New Plagiarism</div>
            <div class="detail-value" style="color: #10b981;">{{ new_plagiarism|floatformat:1 }}%</div>
        </div>
        <div class="detail-item">
            <div class="detail-label">Original AI Score</div>
            <div class="detail-value" style="color: #f59e0b;">{{ original_ai|floatformat:1 }}%</div>
        </div>
        <div class="detail-item">
            <div class="detail-label">New AI Score</div>
            <div class="detail-value" style="color: #10b981;">{{ new_ai|floatformat:1 }}%</div>
        </div>
    </div>
</div>

<!-- Methods Used -->
<div class="card shadow-sm" style="margin-bottom: 30px;">
    <div class="card-header bg-white border-bottom">
        <h5 class="mb-0" style="color: #1a1a1a; font-weight: 700;">üîß Methods Applied</h5>
    </div>
    <div class="card-body">
        {% for method in methods_used %}
            <span class="methods-badge">{{ method|title }}</span>
        {% endfor %}
    </div>
</div>

<!-- Text Comparison -->
<div class="comparison-section">
    <div class="text-box original">
        <h5>üìù Original Text</h5>
        <div class="text-preview">
            {{ removal.original_text|truncatewords:200 }}
        </div>
        <small style="color: #999; display: block; margin-top: 12px;">Plagiarism: <strong style="color: #ef4444;">{{ original_plagiarism|floatformat:1 }}%</strong> | AI: <strong style="color: #f59e0b;">{{ original_ai|floatformat:1 }}%</strong></small>
    </div>
    <div class="text-box processed">
        <h5>‚ú® Processed Text</h5>
        <div class="text-preview">
            {{ removal.processed_text|truncatewords:200 }}
        </div>
        <small style="color: #999; display: block; margin-top: 12px;">Plagiarism: <strong style="color: #10b981;">{{ new_plagiarism|floatformat:1 }}%</strong> | AI: <strong style="color: #10b981;">{{ new_ai|floatformat:1 }}%</strong></small>
        <button class="btn-copy" onclick="copyToClipboard('processed-text')">
            <i class="fas fa-copy me-1"></i>Copy Processed Text
        </button>
    </div>
</div>

<!-- Quality Assessment -->
<div class="card shadow-sm">
    <div class="card-header bg-white border-bottom">
        <h5 class="mb-0" style="color: #1a1a1a; font-weight: 700;">üìä Quality Assessment</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <div class="quality-indicator">
                    {% if improvement > 30 %}
                        <i class="fas fa-star quality-icon" style="color: #10b981;"></i>
                        <h6 style="color: #10b981; margin-bottom: 8px;">Excellent</h6>
                    {% elif improvement > 20 %}
                        <i class="fas fa-thumbs-up quality-icon" style="color: #3b82f6;"></i>
                        <h6 style="color: #3b82f6; margin-bottom: 8px;">Good</h6>
                    {% elif improvement > 10 %}
                        <i class="fas fa-check quality-icon" style="color: #f59e0b;"></i>
                        <h6 style="color: #f59e0b; margin-bottom: 8px;">Fair</h6>
                    {% else %}
                        <i class="fas fa-exclamation quality-icon" style="color: #ef4444;"></i>
                        <h6 style="color: #ef4444; margin-bottom: 8px;">Needs Work</h6>
                    {% endif %}
                    <p style="font-size: 12px; color: #999; margin: 0;">Overall Quality</p>
                </div>
            </div>
            <div class="col-md-9">
                <h6 style="color: #1a1a1a; margin-bottom: 15px;">Recommendations</h6>
                <ul style="list-style: none; padding: 0;">
                    {% if new_similarity > 40 %}
                    <li style="margin-bottom: 10px;"><i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 10px;"></i>Consider additional manual editing for better results</li>
                    {% endif %}
                    {% if improvement < 20 %}
                    <li style="margin-bottom: 10px;"><i class="fas fa-redo" style="color: #f59e0b; margin-right: 10px;"></i>Try processing again with lower target similarity</li>
                    {% endif %}
                    <li style="margin-bottom: 10px;"><i class="fas fa-eye" style="color: #10b981; margin-right: 10px;"></i>Review the processed text for meaning and coherence</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-spell-check" style="color: #10b981; margin-right: 10px;"></i>Check grammar and spelling in the final version</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div style="margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
    <a href="{% url 'plagiarism_removal' %}" class="btn-new-check">+ Process Another Document</a>
    <a href="{% url 'plagiarism_check' %}" style="background: #3b82f6; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-block; transition: all 0.3s;">
        üîç Check for Plagiarism
    </a>
</div>

<textarea id="processed-text" style="position: absolute; left: -9999px;">{{ removal.processed_text }}</textarea>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(elementId) {
    const textArea = document.getElementById(elementId);
    textArea.select();
    document.execCommand('copy');
    
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
    btn.style.background = '#10b981';
    btn.style.color = 'white';
    
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = 'white';
        btn.style.color = '#10b981';
    }, 2000);
}
</script>
{% endblock %}
